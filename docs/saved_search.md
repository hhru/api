# Сохраненные поиски

Сохраненный поиск (автопоиск) — это сохраненный набор параметров поиска, по
которому можно отслеживать новые вакансии или резюме по заданному запросу.
Помимо сохранения параметров поисковых запросов, автопоиск позволяет получать
оповещения о новых результатах поиска. Для удобства автопоиску можно
задавать имя.

* Сохраненные поиски вакансий
  * [Список сохраненных поисков вакансий](#vacancies-saved-search-list)
  * [Получение единичного сохраненного поиска вакансий](#vacancies-saved-search-item)
  * [Создание нового сохраненного поиска вакансий](#vacancies-saved-search-create)
  * [Обновление сохраненного поиска вакансий](#vacancies-saved-search-update)
  * [Удаление сохраненного поиска вакансий](#vacancies-saved-search-delete)
* Сохраненные поиски резюме
  * [Список сохраненных поисков резюме](#resumes-saved-search-list)
  * [Получение единичного сохраненного поиска резюме](#resumes-saved-search-item)
  * [Создание нового сохраненного поиска резюме](#resumes-saved-search-create)
  * [Обновление сохраненного поиска резюме](#resumes-saved-search-update)
  * [Удаление сохраненного поиска резюме](#resumes-saved-search-delete)
  * [Передача сохраненного поиска резюме другому менеджеру](#resumes-saved-search-move-to-other-manager)


<a name="vacancies-saved-search-list"></a>
## Список сохраненных поисков вакансий

`GET /saved_searches/vacancies` вернет список автопоисков с пагинацией.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

Принимаемые параметры:

* `page` - номер страницы (считается от 0, по умолчанию - 0)
* `per_page` - количество элементов (по умолчанию - 10,
  максимальное значение - 10)


Ответом будет стандартная коллекция элементов с пагинацией.


```json
{
  "per_page": 1,
  "page": 0,
  "found": 1,
  "pages": 1,
  "items": [
    {
      "id": "123",
      "name": "Test autosearch",
      "created_at": "2014-04-11T13:12:17+0400",
      "subscription": true,
      "items": {
        "count": 304234,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
      },
      "new_items": {
        "count": 12,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
      }
    }
  ]
}
```

Каждый элемент содержит следующую информацию:

 Имя | Тип | Описание
---- | --- | ---
 id  | строка | Идентификатор
 name | строка | Название
 created_at | строка | Дата и время создания
 subscription | логический | Статус подписки
 items | объект | Данные о списке вакансий
 new_items | объект | Данные о списке вакансий, появившихся с момента последнего просмотра вакансий

В данных о списке вакансий содержится количество элементов в поиске (`count`) и
ссылка на получение данных элементов. При переходе по ссылке из `new_items`
счетчик новых вакансий будет сброшен (сброс значения возможен с небольшой
задержкой во времени).


<a name="vacancies-saved-search-item"></a>
## Получение единичного сохраненного поиска вакансий

Для получения автопоиска по идентификатору неоходимо отправить
`GET /saved_searches/vacancies/{id}`.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

В случае успеха вернется статус `200 OK` с единичным объектом автопоиска в
теле. Например:

```json
{
  "id": "123",
  "name": "Test autosearch",
  "created_at": "2014-04-11T13:12:17+0400",
  "subscription": true,
  "items": {
    "count": 304234,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
  },
  "new_items": {
    "count": 12,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
  }
}
```

В случае, если автопоиск не найден - вернется статус `404 Not Found`.


<a name="vacancies-saved-search-create"></a>
## Создание нового сохраненного поиска вакансий

Для создания автопоиска неоходимо отправить `POST` запрос на
`/saved_searches/vacancies` со следующими параметрами:

* параметры поиска вакансий. Соответствуют параметрам,
  передаваемым в поиск вакансий [/vacancies](vacancies.md#search)

В случае успешного создания вернется ответ `201 Created` с заголовком
`Location`, указывающим на созданный автопоиск (например
`/saved_searches/vacancies/123`, где 123 - id созданного автопоиска).

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`. Если параметры будут указаны неверно или в неправильном сочетании, 
то в ответ вернется `400 Bad request`.


<a name="vacancies-saved-search-update"></a>
## Обновление сохраненного поиска вакансий

У сохраненного поиска возможно изменить имя и статус подписки, для этого
необходимо послать `PUT /saved_searches/vacancies/{id}`, где id -
идентификатор сохраненного поиска.

За один заход можно изменять только имя (параметр `name`) или только статус
подписки (параметр `subscription=false`).

При попытке изменить оба параметра сразу придет ответ `409 Conflict`.
В случае, когда автопоиск не найден, вернется ответ `404 Not Found`.
Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.


<a name="vacancies-saved-search-delete"></a>
## Удаление сохраненного поиска вакансий

Для того, чтобы удалить автопоиск, необходимо выполнить запрос
`DELETE /saved_searches/vacancies/{id}`, где id - идентификатор автопоиска.

В случае, когда автопоиск не был найден, вернется статус `404 Not Found`.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

При успешном удалении автопоиска, вернется статус `204 No Content`.


<a name="resumes-saved-search-list"></a>
##  Список сохраненных поисков резюме

`GET /saved_searches/resumes`

Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`.

Дополнительно можно указать
[стандартные параметры пагинации](general.md#pagination) `page` и `per_page`.
По-умолчанию `per_page` - `5`, максимальное значение - `10`.

Успешный ответ приходит с кодом `200 OK` и содержит:

```json
{
  "per_page": 0,
  "page": 0,
  "pages": 1,
  "found": 2,
  "items": [
    {
      "id": "609535",
      "name": "Managers in Moscow",
      "created_at": "2015-01-01T13:12:17+0400",
      "subscription": true,
      "items": {
        "count": 55,
        "url": "https://api.hh.ru/resumes?order_by=publication_time&saved_search_id=123456&text=manager&area=1"
      },
      "new_items": {
        "count": 15,
        "url": "https://api.hh.ru/resumes?order_by=publication_time&saved_search_id=123456&text=manager&area=1&date_from=2015-11-12T18%3A06%3A04%2B0300"
      },
    }
  ]
}
```

<a name="resumes-saved-search-object"></a>
Каждый элемент коллекции содержит следующую информацию:

название | тип | комментарий
---------|-----|------------
id | строка | идентификатор
name | строка | название
subscription | логический | подключена ли подписка
items | объект | данные о найденных резюме
new_items | объект | данные о найденных резюме, появившихся с момента последнего просмотра автопоиска

Объекты `items` и `new_items` содержат следующие поля:

название | тип | комментарий
---------|-----|------------
count | int | количество результатов сохраненного поиска
url | строка | ссылка на результаты сохраненного поиска, присутствует, если активирован доступ к поиску резюме

Обратите внимание, для получения результатов автопоиска (списка резюме),
необходимо, чтобы приложение, через которое авторизуется работодатель, прошло
[процедуру получения доступа к поиску резюме](employer_resumes.md#resume-search-request).


<a name="resumes-saved-search-item"></a>
# Получение единичного сохраненного поиска резюме

`GET /saved_searches/resumes/{id}`

где `id` – идентификатор автопоиска.

Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`. Если автопоиск не найден или не доступен текущему пользователю,
вернётся ошибка `404 Not Found`.

Успешный ответ приходит с кодом `200 OK` и содержит единичный объект автопоиска,
аналогичный [объектам в списке автопоисков резюме](#resumes-saved-search-object).


<a name="resumes-saved-search-create"></a>
## Создание нового сохраненного поиска резюме

Для создания автопоиска неоходимо отправить `POST` запрос на
`/saved_searches/resumes` со следующими параметрами:

* параметры поиска резюме. Соответствуют параметрам,
  передаваемым в поиск резюме [/resumes](employer_resumes.md#Запрос-и-принимаемые-параметры)

В случае успешного создания вернется ответ `201 Created` с заголовком
`Location`, указывающим на созданный автопоиск (например
`/saved_searches/resumes/123`, где 123 - id созданного автопоиска).

Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`. Если параметры будут указаны неверно или в неправильном сочетании, 
то в ответ вернется `400 Bad request`.


<a name="resumes-saved-search-update"></a>
## Обновление сохраненного поиска резюме

У сохраненного поиска возможно изменить имя и статус подписки, для этого
необходимо послать `PUT /saved_searches/resumes/{id}`, где id -
идентификатор сохраненного поиска.

За один заход можно изменять только имя (параметр `name`) или только статус
подписки (параметр `subscription=false`).

При попытке изменить оба параметра сразу придет ответ `409 Conflict`.
В случае, когда автопоиск не найден, вернется ответ `404 Not Found`.
Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`.


<a name="resumes-saved-search-delete"></a>
## Удаление сохраненного поиска резюме

Для того, чтобы удалить автопоиск, необходимо выполнить запрос
`DELETE /saved_searches/resumes/{id}`, где id - идентификатор автопоиска.

В случае, когда автопоиск не был найден или не принадлежит текущему пользователю, вернется статус `404 Not Found`.

Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`.

При успешном удалении автопоиска, вернется статус `204 No Content`.


<a name="resumes-saved-search-move-to-other-manager"></a>
## Передача сохраненного поиска резюме другому менеджеру

Для того, чтобы передать автопоиск другому менеджеру, необходимо выполнить запрос
`PUT /saved_searches/resumes/{saved_search_id}/managers/{manager_id}`, где saved_search_id - идентификатор автопоиска, 
manager_id - идентификатор менеджера, которому надо передать автопоиск.

В случае, когда автопоиск не был найден или не принадлежит текущему пользователю, а также для несуществующего manager_id 
вернется статус `404 Not Found`. Тело ответа может содержать подробности, позволяющие понять причину ошибки
(`saved_search_not_found` или `manager_not_found`).

Запрос доступен только при авторизации работодателем, иначе вернётся ошибка
`403 Forbidden`.

При успешной передаче автопоиска, вернется статус `204 No Content`.
