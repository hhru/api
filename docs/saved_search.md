# Сохраненные поиски

Сохраненный поиск (автопоиск) — это сохраненный набор параметров поиска, по
которому можно отслеживать новые вакансии или резюме по заданному запросу.
Помимо сохранения параметров поисковых запросов, автопоиск позволяет получать
оповещения о новых результатах поиска. Для удобства автопоиску можно
задавать имя.

* Сохраненные поиски вакансий
  * [Список сохраненных поисков вакансий](#vacancies-saved-search-list)
  * [Получение единичного сохраненного поиска вакансий](#vacancies-saved-search-item)
  * [Создание нового сохраненного поиска вакансий](#vacancies-saved-search-create)
  * [Обновление сохраненного поиска вакансий](#vacancies-saved-search-update)
  * [Удаление сохраненного поиска вакансий](#vacancies-saved-search-delete)


<a name="vacancies-saved-search-list"></a>
## Список сохраненных поисков вакансий

`GET /saved_searches/vacancies` вернет список автопоисков с пагинацией.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

Принимаемые параметры:

* `page` - номер страницы (считается от 0, по умолчанию - 0)
* `per_page` - количество элементов (по умолчанию - 10,
  максимальное значение - 10)


Ответом будет стандартная коллекция элементов с пагинацией.


```json
{
  "per_page": 1,
  "page": 0,
  "found": 1,
  "pages": 1,
  "items": [
    {
      "id": "123",
      "name": "Test autosearch",
      "created_at": "2014-04-11T13:12:17+0400",
      "subscription": true,
      "items": {
        "count": 304234,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
      },
      "new_items": {
        "count": 12,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
      }
    }
  ]
}
```

Каждый элемент содержит следующую информацию:

 Имя | Тип | Описание
---- | --- | ---
 id  | строка | Идентификатор
 name | строка | Название
 created_at | строка | Дата и время создания
 subscription | логический | Статус подписки
 items | объект | Данные о списке вакансий
 new_items | объект | Данные о списке вакансий, появившихся с момента последнего просмотра вакансий

В данных о списке вакансий содержится количество элементов в поиске (`count`) и
ссылка на получение данных элементов. При переходе по ссылке из `new_items`
счетчик новых вакансий будет сброшен (сброс значения возможен с небольшой
задержкой во времени).


<a name="vacancies-saved-search-item"></a>
## Получение единичного сохраненного поиска вакансий

Для получения автопоиска по идентификатору неоходимо отправить
`GET /saved_searches/vacancies/{id}`.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

В случае успеха вернется статус `200 OK` с единичным объектом автопоиска в
теле. Например:

```json
{
  "id": "123",
  "name": "Test autosearch",
  "created_at": "2014-04-11T13:12:17+0400",
  "subscription": true,
  "items": {
    "count": 304234,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
  },
  "new_items": {
    "count": 12,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
  }
}
```

В случае, если автопоиск не найден - вернется статус `404 Not Found`.


<a name="vacancies-saved-search-create"></a>
## Создание нового сохраненного поиска вакансий

Для создания автопоиска неоходимо отправить `POST` запрос на
`/saved_searches/vacancies` со следующими параметрами:

* параметры поиска вакансий. Соответствуют параметрам,
  передаваемым в поиск вакансий [/vacancies](vacancies.md#search)

В случае успешного создания вернется ответ `201 Created` с заголовком
`Location`, указывающим на созданный автопоиск (например
`/saved_searches/vacancies/123`, где 123 - id созданного автопоиска).

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`. Если параметры будут указаны неверно или в неправильном сочетании,
то в ответ вернется `400 Bad request`.


<a name="vacancies-saved-search-update"></a>
## Обновление сохраненного поиска вакансий

У сохраненного поиска возможно изменить имя и статус подписки, для этого
необходимо послать `PUT /saved_searches/vacancies/{id}`, где id -
идентификатор сохраненного поиска.

За один заход можно изменять только имя (параметр `name`) или только статус
подписки (параметр `subscription=false`).

При попытке изменить оба параметра сразу придет ответ `409 Conflict`.
В случае, когда автопоиск не найден, вернется ответ `404 Not Found`.
Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.
Если параметры будут указаны неверно, то в ответ вернется `400 Bad request`. 
Дополнительно к HTTP коду сервер может вернуть описание [причины ошибки](errors.md#general-errors)


<a name="vacancies-saved-search-delete"></a>
## Удаление сохраненного поиска вакансий

Для того, чтобы удалить автопоиск, необходимо выполнить запрос
`DELETE /saved_searches/vacancies/{id}`, где id - идентификатор автопоиска.

В случае, когда автопоиск не был найден, вернется статус `404 Not Found`.

Запрос доступен только при авторизации соискателем, иначе вернётся ошибка
`403 Forbidden`.

При успешном удалении автопоиска, вернется статус `204 No Content`.
